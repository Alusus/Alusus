#!/usr/bin/env alusus
import "Apm.alusus";

@merge module Apm {
    use Srl;
    func start(argCount: Int, argv: ptr[array[ptr[Char]]]): Int {
        if (argCount >= 3 && String.compare(argv~cnt(2), "install") == 0) {
            if(argCount >= 4) {
                installLatestReleaseGlobal(argv~cnt(3)~cast[ptr[array[Char]]]);
            } else {
                Console.print("%suse: apm install <author>/<package>@<release>\n", Console.Color.fgRed());
            }
        } else if (argCount >= 3 && String.compare(argv~cnt(2), "local") == 0) {
            if (argCount >= 4 && String.compare(argv~cnt(2), "install") == 0) {
                if(argCount >= 5) {
                    installLatestReleaseLocal(argv~cnt(3)~cast[ptr[array[Char]]]);
                } else {
                    Console.print("%suse: apm local install <author>/<package>@<release>\n", Console.Color.fgRed());
                }
            } else {
                Console.print("%suse: apm local install <author>/<package>@<release>\n", Console.Color.fgRed());
            }
        }else{
            Console.print("%sCommands:- \n", Console.Color.fgGreen());
            Console.print("%sapm install <author>/<package>@<release>\n", Console.Color.fgYellow());
            Console.print("%suse: apm local install <author>/<package>@<release>\n", Console.Color.fgYellow());
        };

        return 0;
    };
};

Apm.start(Process.argCount, Process.args);